<!doctype html>
<html lang="en">
  <head><script src="/tech/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=tech/livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="Liste - http://localhost:1313/tech/">
    
      <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<script>
  MathJax = {
    tex: {
      displayMath: [['\\[', '\\]'], ['$$', '$$']],  
      inlineMath: [['\\(', '\\)']]                  
    }
  };
</script>
    
    <title>Kaggle: House Price Predicting | DafuZhu</title>
    <meta name="description" content="">
    <meta property="og:url" content="http://localhost:1313/tech/posts/xmu_240626/">
  <meta property="og:site_name" content="DafuZhu">
  <meta property="og:title" content="Kaggle: House Price Predicting">
  <meta property="og:description" content="Import libraries # import libraries import numpy as np import pandas as pd import torch from torch import nn import matplotlib.pyplot as plt from torch.utils.data import DataLoader, TensorDataset Ingest data Raw data can be downloaded here.
train.csv test.csv # ingest data train_data = pd.read_csv(&#34;house-price-data/train.csv&#34;) test_data = pd.read_csv(&#34;house-price-data/test.csv&#34;) Data preprocessing We preprocess the data set first.
Numerical data standardization
Fill in or remove missing values
Filter the features whose type is non-object in “all_features” (that is, numerical features) and standardize them">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-26T19:27:00+08:00">
    <meta property="article:modified_time" content="2024-06-26T19:27:00+08:00">
    <meta property="article:tag" content="Project">
    <meta property="article:tag" content="Xmu">
    <meta property="article:tag" content="2024">

    
  <meta itemprop="name" content="Kaggle: House Price Predicting">
  <meta itemprop="description" content="Import libraries # import libraries import numpy as np import pandas as pd import torch from torch import nn import matplotlib.pyplot as plt from torch.utils.data import DataLoader, TensorDataset Ingest data Raw data can be downloaded here.
train.csv test.csv # ingest data train_data = pd.read_csv(&#34;house-price-data/train.csv&#34;) test_data = pd.read_csv(&#34;house-price-data/test.csv&#34;) Data preprocessing We preprocess the data set first.
Numerical data standardization
Fill in or remove missing values
Filter the features whose type is non-object in “all_features” (that is, numerical features) and standardize them">
  <meta itemprop="datePublished" content="2024-06-26T19:27:00+08:00">
  <meta itemprop="dateModified" content="2024-06-26T19:27:00+08:00">
  <meta itemprop="wordCount" content="1313">
  <meta itemprop="keywords" content="Project,Xmu,2024">
    
  


    
    <link rel="canonical" href="http://localhost:1313/tech/posts/xmu_240626/">
    <link rel="icon" href="http://localhost:1313/tech//assets/favicon.ico">
    <link rel="dns-prefetch" href="https://www.google-analytics.com">
    <link href="https://www.google-analytics.com" rel="preconnect" crossorigin>
    <link rel="alternate" type="application/atom+xml" title="DafuZhu" href="http://localhost:1313/tech//atom.xml" />
    <link rel="alternate" type="application/json" title="DafuZhu" href="http://localhost:1313/tech//feed.json" />
    <link rel="shortcut icon" type="image/png" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNk+A8AAQUBAScY42YAAAAASUVORK5CYII=">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Bricolage+Grotesque">
    <link rel="stylesheet" href="/css/syntax.css">
    
    
    <style>*,:after,:before{box-sizing:border-box;padding:0}body{font:1rem/1.5 bricolage grotesque,-apple-system,BlinkMacSystemFont,segoe ui,Helvetica,Arial,sans-serif;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;padding:2rem;background:#fffdfa;color:#000}.skip-link{position:absolute;top:-40px;left:0;background:#eee;z-index:100}.skip-link:focus{top:0}header{line-height:2;padding-bottom:1.5rem}.link{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;text-decoration:none}.time{font-variant-numeric:tabular-nums;white-space:nowrap}blockquote{border-left:5px solid #eee;padding-left:1rem;margin:0}a,a:visited{color:inherit}a:hover,a.heading-link{text-decoration:none}pre{padding:.5rem;overflow:auto;overflow-x:scroll;overflow-wrap:normal}code,pre{font-family:San Francisco Mono,Monaco,consolas,lucida console,dejavu sans mono,bitstream vera sans mono,monospace;font-size:normal;font-size:small;background:#eee}code{margin:.1rem;border:none}ul{list-style-type:square}ul,ol{padding-left:1.2rem}.list{line-height:2;list-style-type:none;padding-left:0}.list li{padding-bottom:.1rem}.meta{color:#777}.content{max-width:70ch;margin:0 auto}header{line-height:2;display:flex;justify-content:space-between;padding-bottom:1rem}header a{text-decoration:none}header ul{list-style-type:none;padding:0}header li,header a{display:inline}h2.post{padding-top:.5rem}header ul a:first-child{padding-left:1rem}.nav{height:1px;background:#000;content:'';max-width:10%}.list li{display:flex;align-items:baseline}.list li time{flex:initial}.hr-list{margin-top:0;margin-bottom:0;margin-right:.5rem;margin-left:.5rem;height:1px;border:0;border-bottom:1px dotted #ccc;flex:1 0 1rem}.m,hr{border:0;margin:3rem 0}img{max-width:100%;height:auto}.post-date{margin:5% 0}.index-date{color:#9a9a9a}.animate-blink{animation:opacity 1s infinite;opacity:1}@keyframes opacity{0%{opacity:1}50%{opacity:.5}100%{opacity:0}}.tags{display:flex;justify-content:space-between}.tags ul{padding:0;margin:0}.tags li{display:inline}.avatar{height:120px;width:120px;position:relative;margin:-10px 0 0 15px;float:right;border-radius:50%}table{width:100%;border-collapse:collapse}th,td{border:1px solid #ddd;text-align:left;padding:8px}th{background-color:#f2f2f2} </style>
  
    
  
  
  <script type="application/ld+json">
  {
      "@context": "http://schema.org",
      "@type": "BlogPosting",
      "articleSection": "posts",
      "name": "Kaggle: House Price Predicting",
      "headline": "Kaggle: House Price Predicting",
      "alternativeHeadline": "",
      "description": "Import libraries # import libraries import numpy as np import pandas as pd import torch from torch import nn import matplotlib.pyplot as plt from torch.utils.data import DataLoader, TensorDataset Ingest data Raw data can be downloaded here.\ntrain.csv test.csv # ingest data train_data = pd.read_csv(\u0026#34;house-price-data\/train.csv\u0026#34;) test_data = pd.read_csv(\u0026#34;house-price-data\/test.csv\u0026#34;) Data preprocessing We preprocess the data set first.\nNumerical data standardization\nFill in or remove missing values\nFilter the features whose type is non-object in \u0026ldquo;all_features\u0026rdquo; (that is, numerical features) and standardize them",
      "inLanguage": "en-us",
      "isFamilyFriendly": "true",
      "mainEntityOfPage": {
          "@type": "WebPage",
          "@id": "http:\/\/localhost:1313\/tech\/posts\/xmu_240626\/"
      },
      "author" : {
          "@type": "Person",
          "name": ""
      },
      "creator" : {
          "@type": "Person",
          "name": ""
      },
      "accountablePerson" : {
          "@type": "Person",
          "name": ""
      },
      "copyrightHolder" : "DafuZhu",
      "copyrightYear" : "2024",
      "dateCreated": "2024-06-26T19:27:00.00Z",
      "datePublished": "2024-06-26T19:27:00.00Z",
      "dateModified": "2024-06-26T19:27:00.00Z",
      "publisher":{
          "@type":"Organization",
          "name": "DafuZhu",
          "url": "http://localhost:1313/tech/",
          "logo": {
              "@type": "ImageObject",
              "url": "http:\/\/localhost:1313\/tech\/",
              "width":"32",
              "height":"32"
          }
      },
      "image": "http://localhost:1313/tech/",
      "url" : "http:\/\/localhost:1313\/tech\/posts\/xmu_240626\/",
      "wordCount" : "1313",
      "genre" : [ "project" , "xmu" , "2024" ],
      "keywords" : [ "project" , "xmu" , "2024" ]
  }
  </script>
  
</head>

<body>
  <a class="skip-link" href="#main">Skip to main</a>
  <main id="main">
  <div class="content">
    <header>
<p style="padding: 0;margin: 0;">
  <a href="http://localhost:1313/tech/">
    <b>DafuZhu</b>
    <span class="text-stone-500 animate-blink">▮</span>
  </a>
</p>
<ul style="padding: 0;margin: 0;">
  
  
  <li class="">
    <a href="/tech/about/"><span>About</span></a>
    
  <li class="">
    <a href="/tech/posts/"><span>Post</span></a>
    
  </li>
</ul>
</header>
<hr class="hr-list" style="padding: 0;margin: 0;">
    <section>
      <h2 class="post">Kaggle: House Price Predicting</h2>
      <h3 id="import-libraries">Import libraries</h3>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># import libraries</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> <span style="color:#111">numpy</span> <span style="color:#00a8c8">as</span> <span style="color:#111">np</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> <span style="color:#111">pandas</span> <span style="color:#00a8c8">as</span> <span style="color:#111">pd</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> <span style="color:#111">torch</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> <span style="color:#111">torch</span> <span style="color:#f92672">import</span> <span style="color:#111">nn</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> <span style="color:#111">matplotlib.pyplot</span> <span style="color:#00a8c8">as</span> <span style="color:#111">plt</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> <span style="color:#111">torch.utils.data</span> <span style="color:#f92672">import</span> <span style="color:#111">DataLoader</span><span style="color:#111">,</span> <span style="color:#111">TensorDataset</span>
</span></span></code></pre></div><h3 id="ingest-data">Ingest data</h3>
<p>Raw data can be downloaded here.</p>
<ul>
<li><a href="/raw_data/xmu/240626/train.csv">train.csv</a></li>
<li><a href="/raw_data/xmu/240626/test.csv">test.csv</a></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># ingest data</span>
</span></span><span style="display:flex;"><span><span style="color:#111">train_data</span> <span style="color:#f92672">=</span> <span style="color:#111">pd</span><span style="color:#f92672">.</span><span style="color:#111">read_csv</span><span style="color:#111">(</span><span style="color:#d88200">&#34;house-price-data/train.csv&#34;</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span><span style="color:#111">test_data</span> <span style="color:#f92672">=</span> <span style="color:#111">pd</span><span style="color:#f92672">.</span><span style="color:#111">read_csv</span><span style="color:#111">(</span><span style="color:#d88200">&#34;house-price-data/test.csv&#34;</span><span style="color:#111">)</span>
</span></span></code></pre></div><h3 id="data-preprocessing">Data preprocessing</h3>
<p>We preprocess the data set first.</p>
<ul>
<li>
<p>Numerical data <strong>standardization</strong></p>
</li>
<li>
<p>Fill in or remove <strong>missing values</strong></p>
</li>
</ul>
<p>Filter the features whose type is non-object in &ldquo;all_features&rdquo; (that is, numerical features) and standardize them</p>
$$
x\leftarrow \frac{x-\mu(x)}{\sigma(x)}
$$<p>For features of type &ldquo;object&rdquo;, convert them to dummy variables (pd.get_dummies) to make them numeric. &ldquo;Dummy_na=True&rdquo; treats &ldquo;na&rdquo; (missing value) as a valid feature value and creates an indicator feature for it.</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># data preprocessing</span>
</span></span><span style="display:flex;"><span><span style="color:#111">all_features</span> <span style="color:#f92672">=</span> <span style="color:#111">pd</span><span style="color:#f92672">.</span><span style="color:#111">concat</span><span style="color:#111">((</span><span style="color:#111">train_data</span><span style="color:#f92672">.</span><span style="color:#111">iloc</span><span style="color:#111">[:,</span> <span style="color:#ae81ff">1</span><span style="color:#111">:</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#111">],</span> <span style="color:#111">test_data</span><span style="color:#f92672">.</span><span style="color:#111">iloc</span><span style="color:#111">[:,</span> <span style="color:#ae81ff">1</span><span style="color:#111">:]))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># standardizing numerical data</span>
</span></span><span style="display:flex;"><span><span style="color:#111">numeric_features</span> <span style="color:#f92672">=</span> <span style="color:#111">all_features</span><span style="color:#f92672">.</span><span style="color:#111">dtypes</span><span style="color:#111">[</span><span style="color:#111">all_features</span><span style="color:#f92672">.</span><span style="color:#111">dtypes</span> <span style="color:#f92672">!=</span> <span style="color:#d88200">&#39;object&#39;</span><span style="color:#111">]</span><span style="color:#f92672">.</span><span style="color:#111">index</span>
</span></span><span style="display:flex;"><span><span style="color:#111">all_features</span><span style="color:#111">[</span><span style="color:#111">numeric_features</span><span style="color:#111">]</span> <span style="color:#f92672">=</span> <span style="color:#111">all_features</span><span style="color:#111">[</span><span style="color:#111">numeric_features</span><span style="color:#111">]</span><span style="color:#f92672">.</span><span style="color:#111">apply</span><span style="color:#111">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">lambda</span> <span style="color:#111">x</span><span style="color:#111">:</span> <span style="color:#111">(</span><span style="color:#111">x</span> <span style="color:#f92672">-</span> <span style="color:#111">x</span><span style="color:#f92672">.</span><span style="color:#111">mean</span><span style="color:#111">())</span> <span style="color:#f92672">/</span> <span style="color:#111">(</span><span style="color:#111">x</span><span style="color:#f92672">.</span><span style="color:#111">std</span><span style="color:#111">()))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># convert categoric to numeric</span>
</span></span><span style="display:flex;"><span><span style="color:#111">all_features</span> <span style="color:#f92672">=</span> <span style="color:#111">pd</span><span style="color:#f92672">.</span><span style="color:#111">get_dummies</span><span style="color:#111">(</span><span style="color:#111">all_features</span><span style="color:#111">,</span> <span style="color:#111">dummy_na</span><span style="color:#f92672">=</span><span style="color:#00a8c8">True</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># delete missing data</span>
</span></span><span style="display:flex;"><span><span style="color:#111">all_features</span><span style="color:#f92672">.</span><span style="color:#111">dropna</span><span style="color:#111">(</span><span style="color:#111">axis</span><span style="color:#f92672">=</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">how</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;any&#34;</span><span style="color:#111">,</span> <span style="color:#111">inplace</span><span style="color:#f92672">=</span><span style="color:#00a8c8">True</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># split train and test sets</span>
</span></span><span style="display:flex;"><span><span style="color:#111">n_train</span> <span style="color:#f92672">=</span> <span style="color:#111">train_data</span><span style="color:#f92672">.</span><span style="color:#111">shape</span><span style="color:#111">[</span><span style="color:#ae81ff">0</span><span style="color:#111">]</span>
</span></span><span style="display:flex;"><span><span style="color:#111">train_features</span> <span style="color:#f92672">=</span> <span style="color:#111">torch</span><span style="color:#f92672">.</span><span style="color:#111">tensor</span><span style="color:#111">(</span><span style="color:#111">all_features</span><span style="color:#111">[:</span><span style="color:#111">n_train</span><span style="color:#111">]</span><span style="color:#f92672">.</span><span style="color:#111">values</span><span style="color:#f92672">.</span><span style="color:#111">tolist</span><span style="color:#111">(),</span> <span style="color:#111">dtype</span><span style="color:#f92672">=</span><span style="color:#111">torch</span><span style="color:#f92672">.</span><span style="color:#111">float32</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span><span style="color:#111">test_features</span> <span style="color:#f92672">=</span> <span style="color:#111">torch</span><span style="color:#f92672">.</span><span style="color:#111">tensor</span><span style="color:#111">(</span><span style="color:#111">all_features</span><span style="color:#111">[</span><span style="color:#111">n_train</span><span style="color:#111">:]</span><span style="color:#f92672">.</span><span style="color:#111">values</span><span style="color:#f92672">.</span><span style="color:#111">tolist</span><span style="color:#111">(),</span> <span style="color:#111">dtype</span><span style="color:#f92672">=</span><span style="color:#111">torch</span><span style="color:#f92672">.</span><span style="color:#111">float32</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span><span style="color:#111">train_labels</span> <span style="color:#f92672">=</span> <span style="color:#111">torch</span><span style="color:#f92672">.</span><span style="color:#111">tensor</span><span style="color:#111">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">train_data</span><span style="color:#f92672">.</span><span style="color:#111">SalePrice</span><span style="color:#f92672">.</span><span style="color:#111">values</span><span style="color:#f92672">.</span><span style="color:#111">reshape</span><span style="color:#111">(</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#ae81ff">1</span><span style="color:#111">),</span> <span style="color:#111">dtype</span><span style="color:#f92672">=</span><span style="color:#111">torch</span><span style="color:#f92672">.</span><span style="color:#111">float32</span><span style="color:#111">)</span>
</span></span></code></pre></div><h3 id="train-the-model">Train the model</h3>
<p>For house prices, we are more concerned with relative error</p>
$$
\frac{y-\hat{y}}{y}
$$<p>Instead of absolute error \(y-\hat{y}\)</p>
<p>Therefore, the difference is usually measured as the logarithm of the price forecast. This is also the error indicator used by competition officials to evaluate the quality of model submissions. The formula is derived as follows:</p>
<p>\(\exists \delta>0\), s.t. \(|\log y-\log\hat{y}|\leqslant \delta\), namely</p>
$$
-\delta\leqslant \log \frac{y}{\hat{y}}\leqslant \delta
$$$$
e^{-\delta} \leq \frac{\hat{y}}{y} \leq e^\delta
$$<p>This gives the following root-mean-square error between the logarithm of the predicted price and the logarithm of the true label price</p>
$$
\sqrt{\frac{1}{n}\sum_{i=1}^n\left(\log y_i -\log \hat{y}_i\right)^2}.
$$<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#00a8c8">def</span> <span style="color:#75af00">plot</span><span style="color:#111">(</span><span style="color:#111">X</span><span style="color:#111">,</span> <span style="color:#111">Y</span><span style="color:#f92672">=</span><span style="color:#00a8c8">None</span><span style="color:#111">,</span> <span style="color:#111">xlabel</span><span style="color:#f92672">=</span><span style="color:#00a8c8">None</span><span style="color:#111">,</span> <span style="color:#111">ylabel</span><span style="color:#f92672">=</span><span style="color:#00a8c8">None</span><span style="color:#111">,</span> <span style="color:#111">legend</span><span style="color:#f92672">=</span><span style="color:#111">[],</span> <span style="color:#111">xlim</span><span style="color:#f92672">=</span><span style="color:#00a8c8">None</span><span style="color:#111">,</span> <span style="color:#111">ylim</span><span style="color:#f92672">=</span><span style="color:#00a8c8">None</span><span style="color:#111">,</span> <span style="color:#111">xscale</span><span style="color:#f92672">=</span><span style="color:#d88200">&#39;linear&#39;</span><span style="color:#111">,</span> <span style="color:#111">yscale</span><span style="color:#f92672">=</span><span style="color:#d88200">&#39;linear&#39;</span><span style="color:#111">,</span> <span style="color:#111">fmts</span><span style="color:#f92672">=</span><span style="color:#111">(</span><span style="color:#d88200">&#39;-&#39;</span><span style="color:#111">,</span> <span style="color:#d88200">&#39;c--&#39;</span><span style="color:#111">,</span> <span style="color:#d88200">&#39;b-.&#39;</span><span style="color:#111">,</span> <span style="color:#d88200">&#39;orange:&#39;</span><span style="color:#111">),</span> <span style="color:#111">figsize</span><span style="color:#f92672">=</span><span style="color:#111">(</span><span style="color:#ae81ff">3.5</span><span style="color:#111">,</span> <span style="color:#ae81ff">2.5</span><span style="color:#111">),</span> <span style="color:#111">axes</span><span style="color:#f92672">=</span><span style="color:#00a8c8">None</span><span style="color:#111">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#d88200">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#d88200">    Visualization
</span></span></span><span style="display:flex;"><span><span style="color:#d88200">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">def</span> <span style="color:#75af00">has_one_axis</span><span style="color:#111">(</span><span style="color:#111">X</span><span style="color:#111">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#d88200">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#d88200">        Determines if X has only one axis
</span></span></span><span style="display:flex;"><span><span style="color:#d88200">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#00a8c8">return</span> <span style="color:#111">(</span><span style="color:#111">hasattr</span><span style="color:#111">(</span><span style="color:#111">X</span><span style="color:#111">,</span> <span style="color:#d88200">&#34;ndim&#34;</span><span style="color:#111">)</span> <span style="color:#f92672">and</span> <span style="color:#111">X</span><span style="color:#f92672">.</span><span style="color:#111">ndim</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">or</span> <span style="color:#111">isinstance</span><span style="color:#111">(</span><span style="color:#111">X</span><span style="color:#111">,</span> <span style="color:#111">list</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">and</span> <span style="color:#f92672">not</span> <span style="color:#111">hasattr</span><span style="color:#111">(</span><span style="color:#111">X</span><span style="color:#111">[</span><span style="color:#ae81ff">0</span><span style="color:#111">],</span> <span style="color:#d88200">&#34;__len__&#34;</span><span style="color:#111">))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">if</span> <span style="color:#111">has_one_axis</span><span style="color:#111">(</span><span style="color:#111">X</span><span style="color:#111">):</span>  <span style="color:#75715e"># if X is 1D, wrap in list</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">X</span> <span style="color:#f92672">=</span> <span style="color:#111">[</span><span style="color:#111">X</span><span style="color:#111">]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">if</span> <span style="color:#111">Y</span> <span style="color:#f92672">is</span> <span style="color:#00a8c8">None</span><span style="color:#111">:</span>  <span style="color:#75715e"># if Y not provided, assume Y = X and X is empty</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">X</span><span style="color:#111">,</span> <span style="color:#111">Y</span> <span style="color:#f92672">=</span> <span style="color:#111">[[]]</span> <span style="color:#f92672">*</span> <span style="color:#111">len</span><span style="color:#111">(</span><span style="color:#111">X</span><span style="color:#111">),</span> <span style="color:#111">X</span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">elif</span> <span style="color:#111">has_one_axis</span><span style="color:#111">(</span><span style="color:#111">Y</span><span style="color:#111">):</span>  <span style="color:#75715e"># if Y is 1D, wrap in list</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">Y</span> <span style="color:#f92672">=</span> <span style="color:#111">[</span><span style="color:#111">Y</span><span style="color:#111">]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">if</span> <span style="color:#111">len</span><span style="color:#111">(</span><span style="color:#111">X</span><span style="color:#111">)</span> <span style="color:#f92672">!=</span> <span style="color:#111">len</span><span style="color:#111">(</span><span style="color:#111">Y</span><span style="color:#111">):</span>  <span style="color:#75715e"># ensure X, Y have same length</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">X</span> <span style="color:#f92672">=</span> <span style="color:#111">X</span> <span style="color:#f92672">*</span> <span style="color:#111">len</span><span style="color:#111">(</span><span style="color:#111">Y</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">plt</span><span style="color:#f92672">.</span><span style="color:#111">figure</span><span style="color:#111">(</span><span style="color:#111">figsize</span><span style="color:#f92672">=</span><span style="color:#111">figsize</span><span style="color:#111">,</span> <span style="color:#111">dpi</span><span style="color:#f92672">=</span><span style="color:#ae81ff">200</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">if</span> <span style="color:#111">axes</span> <span style="color:#f92672">is</span> <span style="color:#00a8c8">None</span><span style="color:#111">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">axes</span> <span style="color:#f92672">=</span> <span style="color:#111">plt</span><span style="color:#f92672">.</span><span style="color:#111">gca</span><span style="color:#111">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">axes</span><span style="color:#f92672">.</span><span style="color:#111">cla</span><span style="color:#111">()</span>  <span style="color:#75715e"># clear axes</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># plot each series using the given formats</span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">for</span> <span style="color:#111">x</span><span style="color:#111">,</span> <span style="color:#111">y</span><span style="color:#111">,</span> <span style="color:#111">fmt</span> <span style="color:#f92672">in</span> <span style="color:#111">zip</span><span style="color:#111">(</span><span style="color:#111">X</span><span style="color:#111">,</span> <span style="color:#111">Y</span><span style="color:#111">,</span> <span style="color:#111">fmts</span><span style="color:#111">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">axes</span><span style="color:#f92672">.</span><span style="color:#111">plot</span><span style="color:#111">(</span><span style="color:#111">x</span><span style="color:#111">,</span><span style="color:#111">y</span><span style="color:#111">,</span><span style="color:#111">fmt</span><span style="color:#111">)</span> <span style="color:#00a8c8">if</span> <span style="color:#111">len</span><span style="color:#111">(</span><span style="color:#111">x</span><span style="color:#111">)</span> <span style="color:#00a8c8">else</span> <span style="color:#111">axes</span><span style="color:#f92672">.</span><span style="color:#111">plot</span><span style="color:#111">(</span><span style="color:#111">y</span><span style="color:#111">,</span><span style="color:#111">fmt</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">axes</span><span style="color:#f92672">.</span><span style="color:#111">set_xlabel</span><span style="color:#111">(</span><span style="color:#111">xlabel</span><span style="color:#111">),</span> <span style="color:#111">axes</span><span style="color:#f92672">.</span><span style="color:#111">set_ylabel</span><span style="color:#111">(</span><span style="color:#111">ylabel</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">axes</span><span style="color:#f92672">.</span><span style="color:#111">set_xscale</span><span style="color:#111">(</span><span style="color:#111">xscale</span><span style="color:#111">),</span> <span style="color:#111">axes</span><span style="color:#f92672">.</span><span style="color:#111">set_yscale</span><span style="color:#111">(</span><span style="color:#111">yscale</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">axes</span><span style="color:#f92672">.</span><span style="color:#111">set_xlim</span><span style="color:#111">(</span><span style="color:#111">xlim</span><span style="color:#111">),</span>     <span style="color:#111">axes</span><span style="color:#f92672">.</span><span style="color:#111">set_ylim</span><span style="color:#111">(</span><span style="color:#111">ylim</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">if</span> <span style="color:#111">legend</span><span style="color:#111">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">axes</span><span style="color:#f92672">.</span><span style="color:#111">legend</span><span style="color:#111">(</span><span style="color:#111">legend</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">axes</span><span style="color:#f92672">.</span><span style="color:#111">grid</span><span style="color:#111">()</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#00a8c8">class</span> <span style="color:#75af00">NetTrainer</span><span style="color:#111">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#d88200">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#d88200">    Contruct MLP model
</span></span></span><span style="display:flex;"><span><span style="color:#d88200">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">def</span> <span style="color:#111">__init__</span><span style="color:#111">(</span><span style="color:#111">self</span><span style="color:#111">,</span> <span style="color:#111">input_size</span><span style="color:#111">,</span> <span style="color:#111">hidden_sizes</span><span style="color:#f92672">=</span><span style="color:#111">[</span><span style="color:#ae81ff">128</span><span style="color:#111">,</span> <span style="color:#ae81ff">64</span><span style="color:#111">,</span> <span style="color:#ae81ff">32</span><span style="color:#111">]):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">self</span><span style="color:#f92672">.</span><span style="color:#111">loss</span> <span style="color:#f92672">=</span> <span style="color:#111">nn</span><span style="color:#f92672">.</span><span style="color:#111">MSELoss</span><span style="color:#111">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">self</span><span style="color:#f92672">.</span><span style="color:#111">input_size</span> <span style="color:#f92672">=</span> <span style="color:#111">input_size</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">self</span><span style="color:#f92672">.</span><span style="color:#111">hidden_sizes</span> <span style="color:#f92672">=</span> <span style="color:#111">hidden_sizes</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">self</span><span style="color:#f92672">.</span><span style="color:#111">model</span> <span style="color:#f92672">=</span> <span style="color:#111">self</span><span style="color:#f92672">.</span><span style="color:#111">build_model</span><span style="color:#111">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">def</span> <span style="color:#75af00">build_model</span><span style="color:#111">(</span><span style="color:#111">self</span><span style="color:#111">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">layers</span> <span style="color:#f92672">=</span> <span style="color:#111">[]</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">in_size</span> <span style="color:#f92672">=</span> <span style="color:#111">self</span><span style="color:#f92672">.</span><span style="color:#111">input_size</span>
</span></span><span style="display:flex;"><span>        <span style="color:#00a8c8">for</span> <span style="color:#111">hidden_size</span> <span style="color:#f92672">in</span> <span style="color:#111">self</span><span style="color:#f92672">.</span><span style="color:#111">hidden_sizes</span><span style="color:#111">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#111">layers</span><span style="color:#f92672">.</span><span style="color:#111">append</span><span style="color:#111">(</span><span style="color:#111">nn</span><span style="color:#f92672">.</span><span style="color:#111">Linear</span><span style="color:#111">(</span><span style="color:#111">in_size</span><span style="color:#111">,</span> <span style="color:#111">hidden_size</span><span style="color:#111">))</span>
</span></span><span style="display:flex;"><span>            <span style="color:#111">layers</span><span style="color:#f92672">.</span><span style="color:#111">append</span><span style="color:#111">(</span><span style="color:#111">nn</span><span style="color:#f92672">.</span><span style="color:#111">ReLU</span><span style="color:#111">())</span>
</span></span><span style="display:flex;"><span>            <span style="color:#111">in_size</span> <span style="color:#f92672">=</span> <span style="color:#111">hidden_size</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">layers</span><span style="color:#f92672">.</span><span style="color:#111">append</span><span style="color:#111">(</span><span style="color:#111">nn</span><span style="color:#f92672">.</span><span style="color:#111">Linear</span><span style="color:#111">(</span><span style="color:#111">in_size</span><span style="color:#111">,</span> <span style="color:#ae81ff">1</span><span style="color:#111">))</span>
</span></span><span style="display:flex;"><span>        <span style="color:#00a8c8">return</span> <span style="color:#111">nn</span><span style="color:#f92672">.</span><span style="color:#111">Sequential</span><span style="color:#111">(</span><span style="color:#f92672">*</span><span style="color:#111">layers</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">def</span> <span style="color:#75af00">log_rmse</span><span style="color:#111">(</span><span style="color:#111">self</span><span style="color:#111">,</span> <span style="color:#111">features</span><span style="color:#111">,</span> <span style="color:#111">targets</span><span style="color:#111">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">predictions</span> <span style="color:#f92672">=</span> <span style="color:#111">torch</span><span style="color:#f92672">.</span><span style="color:#111">clamp</span><span style="color:#111">(</span><span style="color:#111">self</span><span style="color:#f92672">.</span><span style="color:#111">model</span><span style="color:#111">(</span><span style="color:#111">features</span><span style="color:#111">),</span> <span style="color:#111">min</span><span style="color:#f92672">=</span><span style="color:#ae81ff">1</span><span style="color:#111">)</span>  <span style="color:#75715e"># prevent calculation errors</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">rmse</span> <span style="color:#f92672">=</span> <span style="color:#111">torch</span><span style="color:#f92672">.</span><span style="color:#111">sqrt</span><span style="color:#111">(</span><span style="color:#111">self</span><span style="color:#f92672">.</span><span style="color:#111">loss</span><span style="color:#111">(</span><span style="color:#111">torch</span><span style="color:#f92672">.</span><span style="color:#111">log</span><span style="color:#111">(</span><span style="color:#111">predictions</span><span style="color:#111">),</span> <span style="color:#111">torch</span><span style="color:#f92672">.</span><span style="color:#111">log</span><span style="color:#111">(</span><span style="color:#111">targets</span><span style="color:#111">)))</span>
</span></span><span style="display:flex;"><span>        <span style="color:#00a8c8">return</span> <span style="color:#111">rmse</span><span style="color:#f92672">.</span><span style="color:#111">item</span><span style="color:#111">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">def</span> <span style="color:#75af00">data_loader</span><span style="color:#111">(</span><span style="color:#111">self</span><span style="color:#111">,</span> <span style="color:#111">data</span><span style="color:#111">,</span> <span style="color:#111">batch_size</span><span style="color:#111">,</span> <span style="color:#111">is_training</span><span style="color:#f92672">=</span><span style="color:#00a8c8">True</span><span style="color:#111">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#d88200">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#d88200">        Pytorch iterator
</span></span></span><span style="display:flex;"><span><span style="color:#d88200">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">dataset</span> <span style="color:#f92672">=</span> <span style="color:#111">TensorDataset</span><span style="color:#111">(</span><span style="color:#f92672">*</span><span style="color:#111">data</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># split by batch to build iterators</span>
</span></span><span style="display:flex;"><span>        <span style="color:#00a8c8">return</span> <span style="color:#111">DataLoader</span><span style="color:#111">(</span><span style="color:#111">dataset</span><span style="color:#111">,</span> <span style="color:#111">batch_size</span><span style="color:#111">,</span> <span style="color:#111">shuffle</span><span style="color:#f92672">=</span><span style="color:#111">is_training</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">def</span> <span style="color:#75af00">train_model</span><span style="color:#111">(</span><span style="color:#111">self</span><span style="color:#111">,</span> <span style="color:#111">train_features</span><span style="color:#111">,</span> <span style="color:#111">train_labels</span><span style="color:#111">,</span> <span style="color:#111">valid_features</span><span style="color:#111">,</span> <span style="color:#111">valid_labels</span><span style="color:#111">,</span> <span style="color:#111">epochs</span><span style="color:#111">,</span> <span style="color:#111">lr</span><span style="color:#111">,</span> <span style="color:#111">weight_decay</span><span style="color:#111">,</span> <span style="color:#111">batch_size</span><span style="color:#111">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">train_losses</span><span style="color:#111">,</span> <span style="color:#111">val_losses</span> <span style="color:#f92672">=</span> <span style="color:#111">[],</span> <span style="color:#111">[]</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># load iterator</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">train_loader</span> <span style="color:#f92672">=</span> <span style="color:#111">self</span><span style="color:#f92672">.</span><span style="color:#111">data_loader</span><span style="color:#111">((</span><span style="color:#111">train_features</span><span style="color:#111">,</span> <span style="color:#111">train_labels</span><span style="color:#111">),</span> <span style="color:#111">batch_size</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># choose Adam optimizer</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">optimizer</span> <span style="color:#f92672">=</span> <span style="color:#111">torch</span><span style="color:#f92672">.</span><span style="color:#111">optim</span><span style="color:#f92672">.</span><span style="color:#111">Adam</span><span style="color:#111">(</span><span style="color:#111">self</span><span style="color:#f92672">.</span><span style="color:#111">model</span><span style="color:#f92672">.</span><span style="color:#111">parameters</span><span style="color:#111">(),</span> <span style="color:#111">lr</span><span style="color:#f92672">=</span><span style="color:#111">lr</span><span style="color:#111">,</span> <span style="color:#111">weight_decay</span><span style="color:#f92672">=</span><span style="color:#111">weight_decay</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#00a8c8">for</span> <span style="color:#111">epoch</span> <span style="color:#f92672">in</span> <span style="color:#111">range</span><span style="color:#111">(</span><span style="color:#111">epochs</span><span style="color:#111">):</span>
</span></span><span style="display:flex;"><span>            <span style="color:#00a8c8">for</span> <span style="color:#111">X_batch</span><span style="color:#111">,</span> <span style="color:#111">y_batch</span> <span style="color:#f92672">in</span> <span style="color:#111">train_loader</span><span style="color:#111">:</span>
</span></span><span style="display:flex;"><span>                <span style="color:#111">optimizer</span><span style="color:#f92672">.</span><span style="color:#111">zero_grad</span><span style="color:#111">()</span>
</span></span><span style="display:flex;"><span>                <span style="color:#111">loss</span> <span style="color:#f92672">=</span> <span style="color:#111">self</span><span style="color:#f92672">.</span><span style="color:#111">loss</span><span style="color:#111">(</span><span style="color:#111">self</span><span style="color:#f92672">.</span><span style="color:#111">model</span><span style="color:#111">(</span><span style="color:#111">X_batch</span><span style="color:#111">),</span> <span style="color:#111">y_batch</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#111">loss</span><span style="color:#f92672">.</span><span style="color:#111">backward</span><span style="color:#111">()</span>
</span></span><span style="display:flex;"><span>                <span style="color:#111">optimizer</span><span style="color:#f92672">.</span><span style="color:#111">step</span><span style="color:#111">()</span>
</span></span><span style="display:flex;"><span>            <span style="color:#111">train_losses</span><span style="color:#f92672">.</span><span style="color:#111">append</span><span style="color:#111">(</span><span style="color:#111">self</span><span style="color:#f92672">.</span><span style="color:#111">log_rmse</span><span style="color:#111">(</span><span style="color:#111">train_features</span><span style="color:#111">,</span> <span style="color:#111">train_labels</span><span style="color:#111">))</span>
</span></span><span style="display:flex;"><span>            <span style="color:#00a8c8">if</span> <span style="color:#111">valid_labels</span> <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> <span style="color:#00a8c8">None</span><span style="color:#111">:</span>
</span></span><span style="display:flex;"><span>                <span style="color:#111">val_losses</span><span style="color:#f92672">.</span><span style="color:#111">append</span><span style="color:#111">(</span><span style="color:#111">self</span><span style="color:#f92672">.</span><span style="color:#111">log_rmse</span><span style="color:#111">(</span><span style="color:#111">valid_features</span><span style="color:#111">,</span> <span style="color:#111">valid_labels</span><span style="color:#111">))</span>
</span></span><span style="display:flex;"><span>        <span style="color:#00a8c8">return</span> <span style="color:#111">train_losses</span><span style="color:#111">,</span> <span style="color:#111">val_losses</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">def</span> <span style="color:#75af00">split_kfold_data</span><span style="color:#111">(</span><span style="color:#111">self</span><span style="color:#111">,</span> <span style="color:#111">X</span><span style="color:#111">,</span> <span style="color:#111">y</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">,</span> <span style="color:#111">i</span><span style="color:#111">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#d88200">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#d88200">        In each loop, extract a fold as validation set, leave the rest as training set
</span></span></span><span style="display:flex;"><span><span style="color:#d88200">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#00a8c8">assert</span> <span style="color:#111">k</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">fold_size</span> <span style="color:#f92672">=</span> <span style="color:#111">X</span><span style="color:#f92672">.</span><span style="color:#111">shape</span><span style="color:#111">[</span><span style="color:#ae81ff">0</span><span style="color:#111">]</span> <span style="color:#f92672">//</span> <span style="color:#111">k</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">X_train</span><span style="color:#111">,</span> <span style="color:#111">y_train</span> <span style="color:#f92672">=</span> <span style="color:#00a8c8">None</span><span style="color:#111">,</span> <span style="color:#00a8c8">None</span>
</span></span><span style="display:flex;"><span>        <span style="color:#00a8c8">for</span> <span style="color:#111">j</span> <span style="color:#f92672">in</span> <span style="color:#111">range</span><span style="color:#111">(</span><span style="color:#111">k</span><span style="color:#111">):</span>
</span></span><span style="display:flex;"><span>            <span style="color:#111">idx</span> <span style="color:#f92672">=</span> <span style="color:#111">slice</span><span style="color:#111">(</span><span style="color:#111">j</span> <span style="color:#f92672">*</span> <span style="color:#111">fold_size</span><span style="color:#111">,</span> <span style="color:#111">(</span><span style="color:#111">j</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">)</span> <span style="color:#f92672">*</span> <span style="color:#111">fold_size</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#00a8c8">if</span> <span style="color:#111">j</span> <span style="color:#f92672">==</span> <span style="color:#111">i</span><span style="color:#111">:</span>
</span></span><span style="display:flex;"><span>                <span style="color:#111">X_valid</span><span style="color:#111">,</span> <span style="color:#111">y_valid</span> <span style="color:#f92672">=</span> <span style="color:#111">X</span><span style="color:#111">[</span><span style="color:#111">idx</span><span style="color:#111">,</span> <span style="color:#111">:],</span> <span style="color:#111">y</span><span style="color:#111">[</span><span style="color:#111">idx</span><span style="color:#111">]</span>
</span></span><span style="display:flex;"><span>            <span style="color:#00a8c8">elif</span> <span style="color:#111">X_train</span> <span style="color:#f92672">is</span> <span style="color:#00a8c8">None</span><span style="color:#111">:</span>
</span></span><span style="display:flex;"><span>                <span style="color:#111">X_train</span><span style="color:#111">,</span> <span style="color:#111">y_train</span> <span style="color:#f92672">=</span> <span style="color:#111">X</span><span style="color:#111">[</span><span style="color:#111">idx</span><span style="color:#111">,</span> <span style="color:#111">:],</span> <span style="color:#111">y</span><span style="color:#111">[</span><span style="color:#111">idx</span><span style="color:#111">]</span>
</span></span><span style="display:flex;"><span>            <span style="color:#00a8c8">else</span><span style="color:#111">:</span>
</span></span><span style="display:flex;"><span>                <span style="color:#111">X_train</span> <span style="color:#f92672">=</span> <span style="color:#111">torch</span><span style="color:#f92672">.</span><span style="color:#111">cat</span><span style="color:#111">([</span><span style="color:#111">X_train</span><span style="color:#111">,</span> <span style="color:#111">X</span><span style="color:#111">[</span><span style="color:#111">idx</span><span style="color:#111">,</span> <span style="color:#111">:]],</span> <span style="color:#111">axis</span><span style="color:#f92672">=</span><span style="color:#ae81ff">0</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#111">y_train</span> <span style="color:#f92672">=</span> <span style="color:#111">torch</span><span style="color:#f92672">.</span><span style="color:#111">cat</span><span style="color:#111">([</span><span style="color:#111">y_train</span><span style="color:#111">,</span> <span style="color:#111">y</span><span style="color:#111">[</span><span style="color:#111">idx</span><span style="color:#111">]],</span> <span style="color:#111">axis</span><span style="color:#f92672">=</span><span style="color:#ae81ff">0</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#00a8c8">return</span> <span style="color:#111">X_train</span><span style="color:#111">,</span> <span style="color:#111">y_train</span><span style="color:#111">,</span> <span style="color:#111">X_valid</span><span style="color:#111">,</span> <span style="color:#111">y_valid</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">def</span> <span style="color:#75af00">k_fold_cross_validation</span><span style="color:#111">(</span><span style="color:#111">self</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">,</span> <span style="color:#111">X</span><span style="color:#111">,</span> <span style="color:#111">y</span><span style="color:#111">,</span> <span style="color:#111">epochs</span><span style="color:#111">,</span> <span style="color:#111">lr</span><span style="color:#111">,</span> <span style="color:#111">weight_decay</span><span style="color:#111">,</span> <span style="color:#111">batch_size</span><span style="color:#111">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#d88200">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#d88200">        kfold validate model performance
</span></span></span><span style="display:flex;"><span><span style="color:#d88200">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">total_train_loss</span><span style="color:#111">,</span> <span style="color:#111">total_val_loss</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span><span style="color:#111">,</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#00a8c8">for</span> <span style="color:#111">i</span> <span style="color:#f92672">in</span> <span style="color:#111">range</span><span style="color:#111">(</span><span style="color:#111">k</span><span style="color:#111">):</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># split training set and validation set</span>
</span></span><span style="display:flex;"><span>            <span style="color:#111">X_train</span><span style="color:#111">,</span> <span style="color:#111">y_train</span><span style="color:#111">,</span> <span style="color:#111">X_val</span><span style="color:#111">,</span> <span style="color:#111">y_val</span> <span style="color:#f92672">=</span> <span style="color:#111">self</span><span style="color:#f92672">.</span><span style="color:#111">split_kfold_data</span><span style="color:#111">(</span><span style="color:#111">X</span><span style="color:#111">,</span> <span style="color:#111">y</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">,</span> <span style="color:#111">i</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#111">self</span><span style="color:#f92672">.</span><span style="color:#111">model</span> <span style="color:#f92672">=</span> <span style="color:#111">self</span><span style="color:#f92672">.</span><span style="color:#111">build_model</span><span style="color:#111">()</span>
</span></span><span style="display:flex;"><span>            <span style="color:#111">train_losses</span><span style="color:#111">,</span> <span style="color:#111">val_losses</span> <span style="color:#f92672">=</span> <span style="color:#111">self</span><span style="color:#f92672">.</span><span style="color:#111">train_model</span><span style="color:#111">(</span><span style="color:#111">X_train</span><span style="color:#111">,</span> <span style="color:#111">y_train</span><span style="color:#111">,</span> <span style="color:#111">X_val</span><span style="color:#111">,</span> <span style="color:#111">y_val</span><span style="color:#111">,</span> <span style="color:#111">epochs</span><span style="color:#111">,</span> <span style="color:#111">lr</span><span style="color:#111">,</span> <span style="color:#111">weight_decay</span><span style="color:#111">,</span> <span style="color:#111">batch_size</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#111">total_train_loss</span> <span style="color:#f92672">+=</span> <span style="color:#111">train_losses</span><span style="color:#111">[</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#111">]</span>
</span></span><span style="display:flex;"><span>            <span style="color:#111">total_val_loss</span> <span style="color:#f92672">+=</span> <span style="color:#111">val_losses</span><span style="color:#111">[</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#111">]</span>
</span></span><span style="display:flex;"><span>            <span style="color:#00a8c8">if</span> <span style="color:#111">i</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span><span style="color:#111">:</span>
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># plot the training process</span>
</span></span><span style="display:flex;"><span>                <span style="color:#111">plot</span><span style="color:#111">(</span><span style="color:#111">list</span><span style="color:#111">(</span><span style="color:#111">range</span><span style="color:#111">(</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">epochs</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">)),</span> <span style="color:#111">[</span><span style="color:#111">train_losses</span><span style="color:#111">,</span> <span style="color:#111">val_losses</span><span style="color:#111">],</span> <span style="color:#111">xlabel</span><span style="color:#f92672">=</span><span style="color:#d88200">&#39;Epoch&#39;</span><span style="color:#111">,</span> <span style="color:#111">ylabel</span><span style="color:#f92672">=</span><span style="color:#d88200">&#39;RMSE&#39;</span><span style="color:#111">,</span> <span style="color:#111">xlim</span><span style="color:#f92672">=</span><span style="color:#111">[</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">epochs</span><span style="color:#111">],</span> <span style="color:#111">legend</span><span style="color:#f92672">=</span><span style="color:#111">[</span><span style="color:#d88200">&#39;Train&#39;</span><span style="color:#111">,</span> <span style="color:#d88200">&#39;Validation&#39;</span><span style="color:#111">],</span> <span style="color:#111">yscale</span><span style="color:#f92672">=</span><span style="color:#d88200">&#39;log&#39;</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#111">print</span><span style="color:#111">(</span><span style="color:#d88200">f</span><span style="color:#d88200">&#39;Fold </span><span style="color:#d88200">{</span><span style="color:#111">i</span><span style="color:#f92672">+</span><span style="color:#ae81ff">1</span><span style="color:#d88200">}</span><span style="color:#d88200">: Train loss = </span><span style="color:#d88200">{</span><span style="color:#111">train_losses</span><span style="color:#111">[</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#111">]</span><span style="color:#d88200">:</span><span style="color:#d88200">.4f</span><span style="color:#d88200">}</span><span style="color:#d88200">, Validation loss = </span><span style="color:#d88200">{</span><span style="color:#111">val_losses</span><span style="color:#111">[</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#111">]</span><span style="color:#d88200">:</span><span style="color:#d88200">.4f</span><span style="color:#d88200">}</span><span style="color:#d88200">&#39;</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#00a8c8">return</span> <span style="color:#111">total_train_loss</span> <span style="color:#f92672">/</span> <span style="color:#111">k</span><span style="color:#111">,</span> <span style="color:#111">total_val_loss</span> <span style="color:#f92672">/</span> <span style="color:#111">k</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#00a8c8">def</span> <span style="color:#75af00">train_and_predict</span><span style="color:#111">(</span><span style="color:#111">self</span><span style="color:#111">,</span> <span style="color:#111">train_features</span><span style="color:#111">,</span> <span style="color:#111">test_features</span><span style="color:#111">,</span> <span style="color:#111">train_labels</span><span style="color:#111">,</span> <span style="color:#111">test_df</span><span style="color:#111">,</span> <span style="color:#111">epochs</span><span style="color:#111">,</span> <span style="color:#111">lr</span><span style="color:#111">,</span> <span style="color:#111">weight_decay</span><span style="color:#111">,</span> <span style="color:#111">batch_size</span><span style="color:#111">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#d88200">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#d88200">        model training and predict
</span></span></span><span style="display:flex;"><span><span style="color:#d88200">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">self</span><span style="color:#f92672">.</span><span style="color:#111">model</span> <span style="color:#f92672">=</span> <span style="color:#111">self</span><span style="color:#f92672">.</span><span style="color:#111">build_model</span><span style="color:#111">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># train the model</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">train_losses</span><span style="color:#111">,</span> <span style="color:#111">_</span> <span style="color:#f92672">=</span> <span style="color:#111">self</span><span style="color:#f92672">.</span><span style="color:#111">train_model</span><span style="color:#111">(</span><span style="color:#111">train_features</span><span style="color:#111">,</span> <span style="color:#111">train_labels</span><span style="color:#111">,</span> <span style="color:#00a8c8">None</span><span style="color:#111">,</span> <span style="color:#00a8c8">None</span><span style="color:#111">,</span> <span style="color:#111">epochs</span><span style="color:#111">,</span> <span style="color:#111">lr</span><span style="color:#111">,</span> <span style="color:#111">weight_decay</span><span style="color:#111">,</span> <span style="color:#111">batch_size</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">plot</span><span style="color:#111">(</span><span style="color:#111">np</span><span style="color:#f92672">.</span><span style="color:#111">arange</span><span style="color:#111">(</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">epochs</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">),</span> <span style="color:#111">[</span><span style="color:#111">train_losses</span><span style="color:#111">],</span> <span style="color:#111">xlabel</span><span style="color:#f92672">=</span><span style="color:#d88200">&#39;Epoch&#39;</span><span style="color:#111">,</span> <span style="color:#111">ylabel</span><span style="color:#f92672">=</span><span style="color:#d88200">&#39;Log RMSE&#39;</span><span style="color:#111">,</span> <span style="color:#111">xlim</span><span style="color:#f92672">=</span><span style="color:#111">[</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">epochs</span><span style="color:#111">],</span> <span style="color:#111">yscale</span><span style="color:#f92672">=</span><span style="color:#d88200">&#39;log&#39;</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">print</span><span style="color:#111">(</span><span style="color:#d88200">f</span><span style="color:#d88200">&#39;Training Log RMSE: </span><span style="color:#d88200">{</span><span style="color:#111">float</span><span style="color:#111">(</span><span style="color:#111">train_losses</span><span style="color:#111">[</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#111">])</span><span style="color:#d88200">:</span><span style="color:#d88200">f</span><span style="color:#d88200">}</span><span style="color:#d88200">&#39;</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">predictions</span> <span style="color:#f92672">=</span> <span style="color:#111">self</span><span style="color:#f92672">.</span><span style="color:#111">model</span><span style="color:#111">(</span><span style="color:#111">test_features</span><span style="color:#111">)</span><span style="color:#f92672">.</span><span style="color:#111">detach</span><span style="color:#111">()</span><span style="color:#f92672">.</span><span style="color:#111">numpy</span><span style="color:#111">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">test_df</span><span style="color:#111">[</span><span style="color:#d88200">&#39;SalePrice&#39;</span><span style="color:#111">]</span> <span style="color:#f92672">=</span> <span style="color:#111">pd</span><span style="color:#f92672">.</span><span style="color:#111">Series</span><span style="color:#111">(</span><span style="color:#111">predictions</span><span style="color:#f92672">.</span><span style="color:#111">reshape</span><span style="color:#111">(</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#111">))</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">submission</span> <span style="color:#f92672">=</span> <span style="color:#111">pd</span><span style="color:#f92672">.</span><span style="color:#111">concat</span><span style="color:#111">([</span><span style="color:#111">test_df</span><span style="color:#111">[</span><span style="color:#d88200">&#39;Id&#39;</span><span style="color:#111">],</span> <span style="color:#111">test_df</span><span style="color:#111">[</span><span style="color:#d88200">&#39;SalePrice&#39;</span><span style="color:#111">]],</span> <span style="color:#111">axis</span><span style="color:#f92672">=</span><span style="color:#ae81ff">1</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">submission</span><span style="color:#f92672">.</span><span style="color:#111">to_csv</span><span style="color:#111">(</span><span style="color:#d88200">&#39;submission.csv&#39;</span><span style="color:#111">,</span> <span style="color:#111">index</span><span style="color:#f92672">=</span><span style="color:#00a8c8">False</span><span style="color:#111">)</span>
</span></span></code></pre></div><h3 id="visualization">Visualization</h3>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># set hyperparameters</span>
</span></span><span style="display:flex;"><span><span style="color:#111">k</span><span style="color:#111">,</span> <span style="color:#111">num_epochs</span><span style="color:#111">,</span> <span style="color:#111">learning_rate</span><span style="color:#111">,</span> <span style="color:#111">weight_decay</span><span style="color:#111">,</span> <span style="color:#111">batch_size</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span><span style="color:#111">,</span> <span style="color:#ae81ff">100</span><span style="color:#111">,</span> <span style="color:#ae81ff">0.01</span><span style="color:#111">,</span> <span style="color:#ae81ff">2</span><span style="color:#111">,</span> <span style="color:#ae81ff">64</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># train</span>
</span></span><span style="display:flex;"><span><span style="color:#111">trainer</span> <span style="color:#f92672">=</span> <span style="color:#111">NetTrainer</span><span style="color:#111">(</span><span style="color:#111">train_features</span><span style="color:#f92672">.</span><span style="color:#111">shape</span><span style="color:#111">[</span><span style="color:#ae81ff">1</span><span style="color:#111">])</span>
</span></span><span style="display:flex;"><span><span style="color:#111">avg_train_loss</span><span style="color:#111">,</span> <span style="color:#111">avg_val_loss</span> <span style="color:#f92672">=</span> <span style="color:#111">trainer</span><span style="color:#f92672">.</span><span style="color:#111">k_fold_cross_validation</span><span style="color:#111">(</span><span style="color:#111">k</span><span style="color:#111">,</span> <span style="color:#111">train_features</span><span style="color:#111">,</span> <span style="color:#111">train_labels</span><span style="color:#111">,</span> <span style="color:#111">num_epochs</span><span style="color:#111">,</span> <span style="color:#111">learning_rate</span><span style="color:#111">,</span> <span style="color:#111">weight_decay</span><span style="color:#111">,</span> <span style="color:#111">batch_size</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#111">print</span><span style="color:#111">(</span><span style="color:#d88200">f</span><span style="color:#d88200">&#39;</span><span style="color:#d88200">{</span><span style="color:#111">k</span><span style="color:#d88200">}</span><span style="color:#d88200">-Fold Validation: Average Training Log RMSE: </span><span style="color:#d88200">{</span><span style="color:#111">float</span><span style="color:#111">(</span><span style="color:#111">avg_train_loss</span><span style="color:#111">)</span><span style="color:#d88200">:</span><span style="color:#d88200">.4f</span><span style="color:#d88200">}</span><span style="color:#d88200">, Average Validation Log RMSE: </span><span style="color:#d88200">{</span><span style="color:#111">float</span><span style="color:#111">(</span><span style="color:#111">avg_val_loss</span><span style="color:#111">)</span><span style="color:#d88200">:</span><span style="color:#d88200">.4f</span><span style="color:#d88200">}</span><span style="color:#d88200">&#39;</span><span style="color:#111">)</span>
</span></span></code></pre></div><p><img
  src="/img/xmu/240626/output1.png"
  alt="output1"
  loading="lazy"
  decoding="async"
  class="full-width"
/>

</p>
<p>When training data is scarce, we may not even be able to provide enough data to form a suitable validation set. A popular solution to this problem is to employ K-fold cross-validation. Here, the raw training data is divided into K non-overlapping subsets. The model is then trained and validated K times, each time on K-1 subsets, and validated on the remaining subset (the subset that was not used for training in that round). Finally, the training and validation errors are estimated by <strong>averaging</strong> the results of K experiments.</p>
<p>As can be seen from the loss function plot above, the model bifurcates around the 10th epoch, the training error continues to decline, while the validation error begins to rise, indicating gradual overfitting. The best number of iterations should be at epoch=10.</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#111">num_epochs</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>
</span></span><span style="display:flex;"><span><span style="color:#111">_</span><span style="color:#111">,</span> <span style="color:#111">_</span> <span style="color:#f92672">=</span> <span style="color:#111">trainer</span><span style="color:#f92672">.</span><span style="color:#111">k_fold_cross_validation</span><span style="color:#111">(</span><span style="color:#111">k</span><span style="color:#111">,</span> <span style="color:#111">train_features</span><span style="color:#111">,</span> <span style="color:#111">train_labels</span><span style="color:#111">,</span> <span style="color:#ae81ff">20</span><span style="color:#111">,</span> <span style="color:#111">learning_rate</span><span style="color:#111">,</span> <span style="color:#111">weight_decay</span><span style="color:#111">,</span> <span style="color:#111">batch_size</span><span style="color:#111">)</span>
</span></span></code></pre></div><p><img
  src="/img/xmu/240626/output2.png"
  alt="output2"
  loading="lazy"
  decoding="async"
  class="full-width"
/>

</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#111">trainer</span><span style="color:#f92672">.</span><span style="color:#111">train_and_predict</span><span style="color:#111">(</span><span style="color:#111">train_features</span><span style="color:#111">,</span> <span style="color:#111">test_features</span><span style="color:#111">,</span> <span style="color:#111">train_labels</span><span style="color:#111">,</span> <span style="color:#111">test_data</span><span style="color:#111">,</span> <span style="color:#111">num_epochs</span><span style="color:#111">,</span> <span style="color:#111">learning_rate</span><span style="color:#111">,</span> <span style="color:#111">weight_decay</span><span style="color:#111">,</span> <span style="color:#111">batch_size</span><span style="color:#111">)</span>
</span></span></code></pre></div><p><img
  src="/img/xmu/240626/output3.png"
  alt="output3"
  loading="lazy"
  decoding="async"
  class="full-width"
/>

</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># adjust hyperparameters</span>
</span></span><span style="display:flex;"><span><span style="color:#111">num_epochs</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># train</span>
</span></span><span style="display:flex;"><span><span style="color:#111">trainer</span> <span style="color:#f92672">=</span> <span style="color:#111">NetTrainer</span><span style="color:#111">(</span><span style="color:#111">train_features</span><span style="color:#f92672">.</span><span style="color:#111">shape</span><span style="color:#111">[</span><span style="color:#ae81ff">1</span><span style="color:#111">],</span> <span style="color:#111">hidden_sizes</span><span style="color:#f92672">=</span><span style="color:#111">[</span><span style="color:#ae81ff">128</span><span style="color:#111">,</span> <span style="color:#ae81ff">64</span><span style="color:#111">,</span> <span style="color:#ae81ff">32</span><span style="color:#111">])</span>
</span></span><span style="display:flex;"><span><span style="color:#111">avg_train_loss</span><span style="color:#111">,</span> <span style="color:#111">avg_val_loss</span> <span style="color:#f92672">=</span> <span style="color:#111">trainer</span><span style="color:#f92672">.</span><span style="color:#111">k_fold_cross_validation</span><span style="color:#111">(</span><span style="color:#111">k</span><span style="color:#111">,</span> <span style="color:#111">train_features</span><span style="color:#111">,</span> <span style="color:#111">train_labels</span><span style="color:#111">,</span> <span style="color:#111">num_epochs</span><span style="color:#111">,</span> <span style="color:#111">learning_rate</span><span style="color:#111">,</span> <span style="color:#111">weight_decay</span><span style="color:#111">,</span> <span style="color:#111">batch_size</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#111">print</span><span style="color:#111">(</span><span style="color:#d88200">f</span><span style="color:#d88200">&#39;</span><span style="color:#d88200">{</span><span style="color:#111">k</span><span style="color:#d88200">}</span><span style="color:#d88200">-Fold Validation: Average Training Log RMSE: </span><span style="color:#d88200">{</span><span style="color:#111">float</span><span style="color:#111">(</span><span style="color:#111">avg_train_loss</span><span style="color:#111">)</span><span style="color:#d88200">:</span><span style="color:#d88200">.4f</span><span style="color:#d88200">}</span><span style="color:#d88200">, Average Validation Log RMSE: </span><span style="color:#d88200">{</span><span style="color:#111">float</span><span style="color:#111">(</span><span style="color:#111">avg_val_loss</span><span style="color:#111">)</span><span style="color:#d88200">:</span><span style="color:#d88200">.4f</span><span style="color:#d88200">}</span><span style="color:#d88200">&#39;</span><span style="color:#111">)</span>
</span></span></code></pre></div><p><img
  src="/img/xmu/240626/output4.png"
  alt="output4"
  loading="lazy"
  decoding="async"
  class="full-width"
/>

</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#111">trainer</span><span style="color:#f92672">.</span><span style="color:#111">train_and_predict</span><span style="color:#111">(</span><span style="color:#111">train_features</span><span style="color:#111">,</span> <span style="color:#111">test_features</span><span style="color:#111">,</span> <span style="color:#111">train_labels</span><span style="color:#111">,</span> <span style="color:#111">test_data</span><span style="color:#111">,</span> <span style="color:#111">num_epochs</span><span style="color:#111">,</span> <span style="color:#111">learning_rate</span><span style="color:#111">,</span> <span style="color:#111">weight_decay</span><span style="color:#111">,</span> <span style="color:#111">batch_size</span><span style="color:#111">)</span>
</span></span></code></pre></div><p><img
  src="/img/xmu/240626/output5.png"
  alt="output5"
  loading="lazy"
  decoding="async"
  class="full-width"
/>

</p>
<p>We evaluated the model using 50-fold cross-validation. Throughout the training process, the average training Log RMSE was 0.0807 and the average verification Log RMSE was 0.1592. This shows that our model has good fitting ability on both the training set and the verification set, and the verification error is higher than the training error, indicating that the model is slightly overfitting.</p>
<p>In each fold, the trend of training and validation losses is consistent, which indicates that the performance of the model is stable across different data sets. However, in some folds, we observe large fluctuations in validation losses, which may be due to the presence of noisy data on the validation set or the sensitivity of the model to some specific features.</p>
<p>By plotting a curve for training and verifying losses, we find that:</p>
<ul>
<li>In the early stages of training, losses dropped rapidly, indicating that the model learned the main features of the data relatively quickly.</li>
<li>As the training progresses, the downward trend of loss gradually flattens out, which indicates that the model begins to converge.</li>
<li>In some folds, validation losses rose slightly later in the training, suggesting possible overfitting.</li>
</ul>
<p>Although the model performs well on both the training set and the verification set, the loss on the verification set is slightly higher than that on the training set, suggesting that the model is slightly overfitting. This means that the model fits the training data well, but underperforms on new data.</p>

      
      <div class="post-date">
        <span class="g time">June 26, 2024 </span> &#8729;
         
         <a href="http://localhost:1313/tech/tags/project/">project</a> <a href="http://localhost:1313/tech/tags/xmu/">xmu</a> <a href="http://localhost:1313/tech/tags/2024/">2024</a>
      </div>
      
    </section>
    
    
    <div id="comments">
      
<script src="https://utteranc.es/client.js"
    repo=FortuneQuant/tech
    issue-term="pathname"
    theme=github-light
    crossorigin="anonymous"
    async>
</script>


    </div>
    
    
  </div>
  </main>
  <script type="text/javascript" src="http://localhost:1313/tech/js/copy-code-button.js"></script>
  
    <link rel="stylesheet" href="http://localhost:1313/tech/css/copy-button.css">
</body>
</html>
